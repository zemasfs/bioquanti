{
  "hash": "2781ec51e74e50c6c8434e0fe50cd7e6",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"7 - Interactive maps with `plotly`\"\nformat: html\ntoc: true\nnumber-sections: true\nlang: en\n---\n\n<div class = \"reminder-objetivos\">\nObjectives:\\\n1. Learn about the potential of \"plotly\" for creating interactive maps\\\n2. Create an interactive map with inserted data\\\n3. Create an interactive map with imported data \\\n</div>\n\n\n| Finally, we leave this last part of our course to introduce you to another *\"really cool\"* potential of `plotly` for teaching and learning: the construction of interactive maps. \n\n| Interactive maps allow you to view information by hovering your mouse over the data or by clicking on a map containing that data. Because it is a map, the information is obtained in specific geographic coordinates. This feature therefore makes it essential to have the longitude and latitude coordinates related to the geographic points you want to display.\n\n| Here is a simple example, locating the three municipalities in southern Minas Gerais where the campuses of the Federal University of Alfenas (UNIFAL-MG) are located.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(plotly)\n\n# Create sample data with coordinates of some cities\ncities <- data.frame(\nname = c(\"Alfenas\", \"Varginha\", \"Poços de Caldas\"),\nlat = c(-21.42943530, -21.539957, -21.783731), # Latitude\nlon = c(-45.95948212, -45.433960, -46.564178) # Longitude\n)\n\n# Create the interactive map\nplot_ly(\ndata = cities,\nlat = ~lat,\nlon = ~lon,\ntype = 'scattergeo',\nmode = 'markers+text',\ntext = ~name,\nmarker = list(size = 10, color = 'blue', opacity = 0.7),\ntextposition = \"top center\") %>%\nlayout(\ntitle = \"Municipalities of UNIFAL-MG campuses\",\ngeo = list(\nscope = 'south america',\nshowland = TRUE\n)\n)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"plotly html-widget html-fill-item\" id=\"htmlwidget-f30284df6a9fea4ee34d\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-f30284df6a9fea4ee34d\">{\"x\":{\"visdat\":{\"3eff51584c08\":[\"function () \",\"plotlyVisDat\"]},\"cur_data\":\"3eff51584c08\",\"attrs\":{\"3eff51584c08\":{\"lat\":{},\"lon\":{},\"mode\":\"markers+text\",\"text\":{},\"marker\":{\"size\":10,\"color\":\"blue\",\"opacity\":0.69999999999999996},\"textposition\":\"top center\",\"alpha_stroke\":1,\"sizes\":[10,100],\"spans\":[1,20],\"type\":\"scattergeo\"}},\"layout\":{\"margin\":{\"b\":40,\"l\":60,\"t\":25,\"r\":10},\"title\":\"Municipalities of UNIFAL-MG campuses\",\"geo\":{\"scope\":\"south america\",\"showland\":true},\"hovermode\":\"closest\",\"showlegend\":false},\"source\":\"A\",\"config\":{\"modeBarButtonsToAdd\":[\"hoverclosest\",\"hovercompare\"],\"showSendToCloud\":false},\"data\":[{\"lat\":[-21.429435300000002,-21.539957000000001,-21.783731],\"lon\":[-45.959482119999997,-45.433959999999999,-46.564177999999998],\"mode\":\"markers+text\",\"text\":[\"Alfenas\",\"Varginha\",\"Poços de Caldas\"],\"marker\":{\"color\":\"blue\",\"size\":10,\"opacity\":0.69999999999999996,\"line\":{\"color\":\"rgba(31,119,180,1)\"}},\"textposition\":[\"top center\",\"top center\",\"top center\"],\"type\":\"scattergeo\",\"line\":{\"color\":\"rgba(31,119,180,1)\"},\"frame\":null}],\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.20000000000000001,\"selected\":{\"opacity\":1},\"debounce\":0},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n\n| To view the municipalities, zoom in on the image with your mouse. Note that the map starts in South America, a condition inserted in the code to facilitate the search for cities. Try placing a comment (*#*) to the left of the section \"*scope = ...\"*, and the information will start from the *mundi* map. Now notice that when you hover your mouse over the municipalities, the proposed geographic coordinates are identified.\n\\\n\n<div class=\"reminder-markdown\">\n\n**Now it's your turn:**\n\n1. Locate the geographic coordinates (longitude and latitude) of your hometown or that of a loved one. To do this, search the internet;\n2. Copy the code above and paste it into a new script; \n3. Replace the attributes *\"name\"*, *\"lat\"*, and *\"lon\"* in the `data.frame` of the code with the ones you found.\n4. Run the script and observe the selected municipality on the interactive map.\nTip: if you selected a city outside South America, put a *\"#\"* before the line \"*scope = ...\"*.\n\n</div>\n\n\n## World oil production\n\n\n| Now imagine that instead of entering the data one by one, you can *import the data from an online repository* to build the map, as was done in the previous step. To illustrate this, let's import a spreadsheet on global oil production. This category includes crude oil, shale oil, tar sands, condensates, and natural gas liquids (ethane, LPG, and naphtha separated from natural gas production).\n\nAt the same time, we will filter the imported data for the year 2014, as found in the [Our World In Data](https://github.com/owid/owid-datasets/tree/master/datasets) database. \n\n\n![World oil production. Source: MAPA: secondary education - Human sciences and their technologies. 3rd term. 2nd year, p.81.](petroleo_mapa.png)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(plotly)\n\n# Example of dataframe with fictitious values\ndf <- read.csv(\"https://raw.githubusercontent.com/owid/owid-datasets/refs/heads/master/datasets/Oil%20production%20-%20Etemad%20%26%20Luciana/Oil%20production%20-%20Etemad%20%26%20Luciana.csv\")\n\n# Renaming columns to facilitate interpretation and plotting\n\nnames(df) <- c(\"Country\", \"Year\", \"Production.TeraWatt\")\n\n# Filtering data for the last year (2014)\ndf <- subset(df, Year == \"2014\")\n\nhead(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      Country Year Production.TeraWatt\n82    Albania 2014            12.10759\n165   Algeria 2014          1014.64045\n224    Angola 2014          1035.41999\n331 Argentina 2014           421.63374\n351     Aruba 2014             1.65714\n402 Australia 2014           281.78225\n```\n\n\n:::\n\n```{.r .cell-code}\n# Creating the choropleth map with the color scale adjusted\nlibrary(plotly)\nplot_ly(\ndata = df,\nlocations = ~Country,\nlocationmode = \"country names\",\nz = ~Production.TeraWatt, # Variable that determines the colors\ntype = \"choropleth\",\ncolorscale = \"RdBu\") # other scales: # other scales: Viridis, Inferno, Blues, Cividis, Greens, ...\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"plotly html-widget html-fill-item\" id=\"htmlwidget-46be1aa242969f00a112\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-46be1aa242969f00a112\">{\"x\":{\"visdat\":{\"3eff86690e3\":[\"function () \",\"plotlyVisDat\"]},\"cur_data\":\"3eff86690e3\",\"attrs\":{\"3eff86690e3\":{\"locations\":{},\"locationmode\":\"country names\",\"z\":{},\"colorscale\":\"RdBu\",\"alpha_stroke\":1,\"sizes\":[10,100],\"spans\":[1,20],\"type\":\"choropleth\"}},\"layout\":{\"margin\":{\"b\":40,\"l\":60,\"t\":25,\"r\":10},\"scene\":{\"zaxis\":{\"title\":\"Production.TeraWatt\"}},\"hovermode\":\"closest\",\"showlegend\":false,\"legend\":{\"yanchor\":\"top\",\"y\":0.5}},\"source\":\"A\",\"config\":{\"modeBarButtonsToAdd\":[\"hoverclosest\",\"hovercompare\"],\"showSendToCloud\":false},\"data\":[{\"colorbar\":{\"title\":\"Production.TeraWatt\",\"ticklen\":2,\"len\":0.5,\"lenmode\":\"fraction\",\"y\":1,\"yanchor\":\"top\"},\"colorscale\":\"RdBu\",\"showscale\":true,\"locations\":[\"Albania\",\"Algeria\",\"Angola\",\"Argentina\",\"Aruba\",\"Australia\",\"Austria\",\"Azerbaijan\",\"Bahrain\",\"Bangladesh\",\"Barbados\",\"Belarus\",\"Belgium\",\"Belize\",\"Bolivia\",\"Bosnia and Herzegovina\",\"Brazil\",\"Brunei\",\"Bulgaria\",\"Cambodia\",\"Cameroon\",\"Canada\",\"Chad\",\"Chile\",\"China\",\"Colombia\",\"Congo\",\"Costa Rica\",\"Cote d'Ivoire\",\"Croatia\",\"Cuba\",\"Czech Republic\",\"Democratic Republic of Congo\",\"Denmark\",\"Dominican Republic\",\"Ecuador\",\"Egypt\",\"El Salvador\",\"Equatorial Guinea\",\"Estonia\",\"Ethiopia\",\"Fiji\",\"Finland\",\"France\",\"Gabon\",\"Georgia\",\"Germany\",\"Ghana\",\"Greece\",\"Guatemala\",\"Honduras\",\"Hong Kong\",\"Hungary\",\"India\",\"Indonesia\",\"Iran\",\"Iraq\",\"Ireland\",\"Israel\",\"Italy\",\"Jamaica\",\"Japan\",\"Jordan\",\"Kazakhstan\",\"Kenya\",\"Kuwait\",\"Kyrgyzstan\",\"Latvia\",\"Libya\",\"Lithuania\",\"Macedonia\",\"Malawi\",\"Malaysia\",\"Martinique\",\"Mauritania\",\"Mexico\",\"Moldova\",\"Mongolia\",\"Morocco\",\"Mozambique\",\"Netherlands\",\"Netherlands Antilles\",\"New Zealand\",\"Nicaragua\",\"Niger\",\"Nigeria\",\"North Korea\",\"Norway\",\"Oman\",\"Pakistan\",\"Papua New Guinea\",\"Paraguay\",\"Peru\",\"Philippines\",\"Poland\",\"Portugal\",\"Puerto Rico\",\"Qatar\",\"Romania\",\"Russia\",\"Rwanda\",\"Saudi Arabia\",\"Senegal\",\"Serbia\",\"Sierra Leone\",\"Singapore\",\"Slovakia\",\"Slovenia\",\"South Africa\",\"South Korea\",\"Spain\",\"Sri Lanka\",\"Suriname\",\"Sweden\",\"Switzerland\",\"Syria\",\"Taiwan\",\"Tajikistan\",\"Tanzania\",\"Thailand\",\"Timor\",\"Trinidad and Tobago\",\"Tunisia\",\"Turkey\",\"Turkmenistan\",\"Ukraine\",\"United Arab Emirates\",\"United Kingdom\",\"United States\",\"United States Virgin Islands\",\"Uruguay\",\"Uzbekistan\",\"Venezuela\",\"Vietnam\",\"Yemen\",\"Zambia\",\"Zimbabwe\"],\"locationmode\":\"country names\",\"z\":[12.107593899999999,1014.640452,1035.419995,421.63374279999999,1.6571400599999999,281.78224820000003,15.63465214,504.59416929999998,37.533506320000001,2.8211879020000001,0.59016597100000001,18.906736280000001,7.6267602419999996,1.0717083869999999,39.629497559999997,0.018836966,1739.058634,73.098894610000002,1.9949083759999999,0.00029478799999999998,47.964622050000003,2584.299125,60.975122730000002,9.0490543359999993,2695.6093390000001,599.1940955,152.6481618,0.171378066,21.606141279999999,10.798168309999999,28.728666310000001,6.2949071659999998,11.791527889999999,100.5632851,0.036023118,328.55581979999999,393.17940049999999,0.30284181100000002,158.59605020000001,7.6644931310000004,0.058957638999999999,0.017687292,5.8668747039999998,36.202343040000002,141.2811466,0.58957639500000003,93.763800759999995,62.668456880000001,5.1556333240000001,8.2947149220000007,0.011791528000000001,0.058957638999999999,14.89562403,576.32469830000002,537.27673530000004,1989.6316790000001,1987.6678179999999,0.54417901199999996,3.394191304,99.890248260000007,1.2496720219999999,80.896808870000001,0.097138607000000002,1013.681093,0.034248492999999998,1639.2605900000001,0.49665915500000002,0.58957639500000003,304.32654109999999,5.3714949289999998,0.024095986999999999,0.117915279,411.07839150000001,0.146940125,3.5392329930000002,1657.8487540000001,0.010205567,12.29083425,2.981434766,0.011791528000000001,23.748620630000001,0.88192964200000001,29.309741020000001,0.090499976999999995,11.791527889999999,1431.1075310000001,0.051411062,1122.779352,560.60096120000003,57.759366720000003,20.261311630000002,1.179152789,106.16525129999999,15.475401659999999,23.144723429999999,4.173611298,0.397197617,1211.4166379999999,61.069166060000001,6398.6354449999999,0.0058957640000000004,6853.0574589999997,0.020110451000000001,12.123712919999999,0.014969345,11.890240670000001,5.3421517119999997,0.1798208,94.2798157,46.507554740000003,23.626200990000001,0.32041118699999999,8.5144264619999994,6.898633394,2.2816606469999998,19.282255169999999,12.78353145,0.12428270399999999,0.0058957640000000004,248.86938180000001,45.096940160000003,68.67018539,35.014181530000002,36.227246749999999,162.9322018,38.765467460000004,2046.17659,534.36519480000004,8237.9135170000009,8.7731089999999998,0.69738633400000005,49.853153159999998,1585.513809,186.2070506,75.170943159999993,0.102945934,0.070749167000000002],\"type\":\"choropleth\",\"marker\":{\"line\":{\"color\":\"rgba(31,119,180,1)\"}},\"frame\":null}],\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.20000000000000001,\"selected\":{\"opacity\":1},\"debounce\":0},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n\n| Following the same logic as the previous map, if you hover your mouse over the countries, you will see the consumption identified in each one. Note that there is a sidebar showing the legend about the production quantity, in Note also that the \"type\" of the graph is now choropleth (and not scattergeo). In its simplest version, it only needs the standardized names of the countries. But it can also be done with a database that only has the geographical coordinates of latitude and longitude.\n\n| To help with this, here are two useful links to geographic coordinate files, accessible via `R`:\n\n* [Coordinates of Brazilian municipalities](https://raw.githubusercontent.com/kelvins/municipios-brasileiros/refs/heads/main/csv/municipios.csv)\n* [Coordinates of world capitals](https://raw.githubusercontent.com/bahar/WorldCityLocations/refs/heads/master/World_Cities_Location_table.csv)\n\n| In this case, any database on this subject would be welcome. In practice, this means being able to illustrate any educational content interactively on a map (e.g., production/export of raw materials, clinical observations, historical landmarks, etc.).\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../../../site_libs/htmltools-fill-0.5.8.1/fill.css\" rel=\"stylesheet\" />\n<script src=\"../../../../site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<script src=\"../../../../site_libs/plotly-binding-4.10.4/plotly.js\"></script>\n<script src=\"../../../../site_libs/typedarray-0.1/typedarray.min.js\"></script>\n<script src=\"../../../../site_libs/jquery-3.5.1/jquery.min.js\"></script>\n<link href=\"../../../../site_libs/crosstalk-1.2.1/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"../../../../site_libs/crosstalk-1.2.1/js/crosstalk.min.js\"></script>\n<link href=\"../../../../site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css\" rel=\"stylesheet\" />\n<script src=\"../../../../site_libs/plotly-main-2.11.1/plotly-latest.min.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}