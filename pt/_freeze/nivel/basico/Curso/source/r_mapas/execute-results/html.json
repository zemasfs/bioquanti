{
  "hash": "a512a8630e0af16348a96ebf5afb13b0",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"7 - Mapas interativos com `plotly`\"\nformat: html\ntoc: true\nnumber-sections: true\nlang: pt\n---\n\n<div class = \"reminder-objetivos\">\nObjetivos:\\\n  1. Conhecer o potencial do \"plotly\" para criação de mapas interativos\\\n  2. Elaborar um mapa interativo com dados inseridos\\\n  3. Elaborar um mapa interativo com dados importados \\\n</div>\n\n\n|       Por fim, deixamos esta última parte de nosso curso para lhe apresentar outro potencial *\"pra lá de bacana\"* do `plotly` para ensino e aprendizagem: a construção de mapas interativos. \n\n|       Mapas interativos permitem que se observe informações por *mouse hover* (passagem do *mouse* sobre os dados) ou por clique de *mouse* sobre um mapa contendo esses dados. Por se tratar de um mapa, as informações são obtidas em coordenadas geográficas específicas. Essa característica torna indispensável, portanto, as *coordenadas de longitude e de latitude* relacionadas aos pontos geográficos que se deseja apresentar.\n\n|       Segue um exemplo simples, localizando os três municípios do Sul de Minas Gerais onde ficam os campi da Universidade Federal de Alfenas (UNIFAL-MG).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(plotly)\n\n# Criar dados de exemplo com coordenadas de algumas cidades\ncities <- data.frame(\n  name = c(\"Alfenas\", \"Varginha\", \"Poços de Caldas\"),\n  lat = c(-21.42943530, -21.539957, -21.783731),  # Latitude\n  lon = c(-45.95948212, -45.433960, -46.564178)   # Longitude\n)\n\n# Criar o mapa interativo\nplot_ly(\n  data = cities,\n  lat = ~lat,\n  lon = ~lon,\n  type = 'scattergeo',\n  mode = 'markers+text',\n  text = ~name,\n  marker = list(size = 10, color = 'blue', opacity = 0.7),\n  textposition = \"top center\"\n) %>%\n  layout(\n    title = \"Municípios dos campi da UNIFAL-MG\",\n    geo = list(\n      scope = 'south america',\n      showland = TRUE\n    )\n  )\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"plotly html-widget html-fill-item\" id=\"htmlwidget-466890753aba67205abf\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-466890753aba67205abf\">{\"x\":{\"visdat\":{\"112063ab69538\":[\"function () \",\"plotlyVisDat\"]},\"cur_data\":\"112063ab69538\",\"attrs\":{\"112063ab69538\":{\"lat\":{},\"lon\":{},\"mode\":\"markers+text\",\"text\":{},\"marker\":{\"size\":10,\"color\":\"blue\",\"opacity\":0.69999999999999996},\"textposition\":\"top center\",\"alpha_stroke\":1,\"sizes\":[10,100],\"spans\":[1,20],\"type\":\"scattergeo\"}},\"layout\":{\"margin\":{\"b\":40,\"l\":60,\"t\":25,\"r\":10},\"title\":\"Municípios dos campi da UNIFAL-MG\",\"geo\":{\"scope\":\"south america\",\"showland\":true},\"hovermode\":\"closest\",\"showlegend\":false},\"source\":\"A\",\"config\":{\"modeBarButtonsToAdd\":[\"hoverclosest\",\"hovercompare\"],\"showSendToCloud\":false},\"data\":[{\"lat\":[-21.429435300000002,-21.539957000000001,-21.783731],\"lon\":[-45.959482119999997,-45.433959999999999,-46.564177999999998],\"mode\":\"markers+text\",\"text\":[\"Alfenas\",\"Varginha\",\"Poços de Caldas\"],\"marker\":{\"color\":\"blue\",\"size\":10,\"opacity\":0.69999999999999996,\"line\":{\"color\":\"rgba(31,119,180,1)\"}},\"textposition\":[\"top center\",\"top center\",\"top center\"],\"type\":\"scattergeo\",\"line\":{\"color\":\"rgba(31,119,180,1)\"},\"frame\":null}],\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.20000000000000001,\"selected\":{\"opacity\":1},\"debounce\":0},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n\n|       Para observar os municípios, vá ampliando a imagem com o *mouse*. Veja que o mapa inicia na América do Sul, uma condição inserida no código para facilitar a busca das cidades. Experimente colocar um comentário (*#*) à esquerda do trecho \"*scope = ...\"*, e a informação partirá do mapa *mundi.* Observe agora que ao passar o *mouse* sobre os municípios é identificada as coordenadas geográficas propostas.\n\\\n\n<div class=\"reminder-markdown\">\n\n**Agora é com voce:**\n\n1. Localize as coordenadas geográficas (longitude e latitude) de sua cidade Natal, ou da de um ente querido. Pra isso, dê uma busca na internet; \n2. Copie o código acima, e cole-o num novo script;  \n3. Substitua os atributos *\"name\"*, *\"lat\"*, e *\"lon\"* no `data.frame` do código  pelos que você buscou.\n4. Rode o script e observe no mapa interativo o município escolhido. \nDica: se você selecionou uma cidade fora da América do Sul, colocar um *\"#\"* antes da linha de \"*scope = ...\"*.\n\n</div>\n\n\n## Produção mundial de óleos\n\n\n|       Agora imagine que você possa, ao invés de colocar os dados um a um, *importar os dados de algum repositório da internet* para a construção do mapa, como fora conduzido na etapa anterior. Para ilustrar isso vamos importar uma planilha referente à produção de óleo no planeta. Essa categoria inclui petróleo bruto, óleo de xisto, areias betuminosas, condensados, e líquidos de gás natural (etano, GLP e nafta separados da produção de gás natural).\n\n|       Ao mesmo tempo, vamos filtrar os dados importados para o ano de 2014, tal como encontrado no banco de dados do [Our World In Data](https://github.com/owid/owid-datasets/tree/master/datasets). \n\n\n![Produção mundial de petróleo. Fonte: MAPA: ensino médio - Ciências humanas e suas tecnologias. 3º Bim. 2º Ano, p.81.](petroleo_mapa.png)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(plotly)\n\n# Exemplo de dataframe com valores fictícios\ndf <- read.csv(\"https://raw.githubusercontent.com/owid/owid-datasets/refs/heads/master/datasets/Oil%20production%20-%20Etemad%20%26%20Luciana/Oil%20production%20-%20Etemad%20%26%20Luciana.csv\")\n\n# Renomeando as colunas para facilitar interpretação e plotagem\n\nnames(df) <- c(\"País\", \"Ano\", \"Produção.TeraWatt\")\n\n# Filtrando os dados para o último ano (2014)\ndf <- subset(df, Ano == \"2014\")\n\nhead(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n         País  Ano Produção.TeraWatt\n82    Albania 2014          12.10759\n165   Algeria 2014        1014.64045\n224    Angola 2014        1035.41999\n331 Argentina 2014         421.63374\n351     Aruba 2014           1.65714\n402 Australia 2014         281.78225\n```\n\n\n:::\n\n```{.r .cell-code}\n# Criando o mapa choropleth com a escala de cores ajustada\nlibrary(plotly)\nplot_ly(\n  data = df,\n  locations = ~País,\n  locationmode = \"country names\",\n  z = ~Produção.TeraWatt, # Variável que determina as cores\n  type = \"choropleth\",\n  colorscale = \"RdBu\") # outras escalas: # outras escalas: Viridis, Inferno, Blues, Cividis, Greens, ...\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"plotly html-widget html-fill-item\" id=\"htmlwidget-afe673ac7c2553b1e040\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-afe673ac7c2553b1e040\">{\"x\":{\"visdat\":{\"112066e8c9489\":[\"function () \",\"plotlyVisDat\"]},\"cur_data\":\"112066e8c9489\",\"attrs\":{\"112066e8c9489\":{\"locations\":{},\"locationmode\":\"country names\",\"z\":{},\"colorscale\":\"RdBu\",\"alpha_stroke\":1,\"sizes\":[10,100],\"spans\":[1,20],\"type\":\"choropleth\"}},\"layout\":{\"margin\":{\"b\":40,\"l\":60,\"t\":25,\"r\":10},\"scene\":{\"zaxis\":{\"title\":\"Produção.TeraWatt\"}},\"hovermode\":\"closest\",\"showlegend\":false,\"legend\":{\"yanchor\":\"top\",\"y\":0.5}},\"source\":\"A\",\"config\":{\"modeBarButtonsToAdd\":[\"hoverclosest\",\"hovercompare\"],\"showSendToCloud\":false},\"data\":[{\"colorbar\":{\"title\":\"Produção.TeraWatt\",\"ticklen\":2,\"len\":0.5,\"lenmode\":\"fraction\",\"y\":1,\"yanchor\":\"top\"},\"colorscale\":\"RdBu\",\"showscale\":true,\"locations\":[\"Albania\",\"Algeria\",\"Angola\",\"Argentina\",\"Aruba\",\"Australia\",\"Austria\",\"Azerbaijan\",\"Bahrain\",\"Bangladesh\",\"Barbados\",\"Belarus\",\"Belgium\",\"Belize\",\"Bolivia\",\"Bosnia and Herzegovina\",\"Brazil\",\"Brunei\",\"Bulgaria\",\"Cambodia\",\"Cameroon\",\"Canada\",\"Chad\",\"Chile\",\"China\",\"Colombia\",\"Congo\",\"Costa Rica\",\"Cote d'Ivoire\",\"Croatia\",\"Cuba\",\"Czech Republic\",\"Democratic Republic of Congo\",\"Denmark\",\"Dominican Republic\",\"Ecuador\",\"Egypt\",\"El Salvador\",\"Equatorial Guinea\",\"Estonia\",\"Ethiopia\",\"Fiji\",\"Finland\",\"France\",\"Gabon\",\"Georgia\",\"Germany\",\"Ghana\",\"Greece\",\"Guatemala\",\"Honduras\",\"Hong Kong\",\"Hungary\",\"India\",\"Indonesia\",\"Iran\",\"Iraq\",\"Ireland\",\"Israel\",\"Italy\",\"Jamaica\",\"Japan\",\"Jordan\",\"Kazakhstan\",\"Kenya\",\"Kuwait\",\"Kyrgyzstan\",\"Latvia\",\"Libya\",\"Lithuania\",\"Macedonia\",\"Malawi\",\"Malaysia\",\"Martinique\",\"Mauritania\",\"Mexico\",\"Moldova\",\"Mongolia\",\"Morocco\",\"Mozambique\",\"Netherlands\",\"Netherlands Antilles\",\"New Zealand\",\"Nicaragua\",\"Niger\",\"Nigeria\",\"North Korea\",\"Norway\",\"Oman\",\"Pakistan\",\"Papua New Guinea\",\"Paraguay\",\"Peru\",\"Philippines\",\"Poland\",\"Portugal\",\"Puerto Rico\",\"Qatar\",\"Romania\",\"Russia\",\"Rwanda\",\"Saudi Arabia\",\"Senegal\",\"Serbia\",\"Sierra Leone\",\"Singapore\",\"Slovakia\",\"Slovenia\",\"South Africa\",\"South Korea\",\"Spain\",\"Sri Lanka\",\"Suriname\",\"Sweden\",\"Switzerland\",\"Syria\",\"Taiwan\",\"Tajikistan\",\"Tanzania\",\"Thailand\",\"Timor\",\"Trinidad and Tobago\",\"Tunisia\",\"Turkey\",\"Turkmenistan\",\"Ukraine\",\"United Arab Emirates\",\"United Kingdom\",\"United States\",\"United States Virgin Islands\",\"Uruguay\",\"Uzbekistan\",\"Venezuela\",\"Vietnam\",\"Yemen\",\"Zambia\",\"Zimbabwe\"],\"locationmode\":\"country names\",\"z\":[12.107593899999999,1014.640452,1035.419995,421.63374279999999,1.6571400599999999,281.78224820000003,15.63465214,504.59416929999998,37.533506320000001,2.8211879020000001,0.59016597100000001,18.906736280000001,7.6267602419999996,1.0717083869999999,39.629497559999997,0.018836966,1739.058634,73.098894610000002,1.9949083759999999,0.00029478799999999998,47.964622050000003,2584.299125,60.975122730000002,9.0490543359999993,2695.6093390000001,599.1940955,152.6481618,0.171378066,21.606141279999999,10.798168309999999,28.728666310000001,6.2949071659999998,11.791527889999999,100.5632851,0.036023118,328.55581979999999,393.17940049999999,0.30284181100000002,158.59605020000001,7.6644931310000004,0.058957638999999999,0.017687292,5.8668747039999998,36.202343040000002,141.2811466,0.58957639500000003,93.763800759999995,62.668456880000001,5.1556333240000001,8.2947149220000007,0.011791528000000001,0.058957638999999999,14.89562403,576.32469830000002,537.27673530000004,1989.6316790000001,1987.6678179999999,0.54417901199999996,3.394191304,99.890248260000007,1.2496720219999999,80.896808870000001,0.097138607000000002,1013.681093,0.034248492999999998,1639.2605900000001,0.49665915500000002,0.58957639500000003,304.32654109999999,5.3714949289999998,0.024095986999999999,0.117915279,411.07839150000001,0.146940125,3.5392329930000002,1657.8487540000001,0.010205567,12.29083425,2.981434766,0.011791528000000001,23.748620630000001,0.88192964200000001,29.309741020000001,0.090499976999999995,11.791527889999999,1431.1075310000001,0.051411062,1122.779352,560.60096120000003,57.759366720000003,20.261311630000002,1.179152789,106.16525129999999,15.475401659999999,23.144723429999999,4.173611298,0.397197617,1211.4166379999999,61.069166060000001,6398.6354449999999,0.0058957640000000004,6853.0574589999997,0.020110451000000001,12.123712919999999,0.014969345,11.890240670000001,5.3421517119999997,0.1798208,94.2798157,46.507554740000003,23.626200990000001,0.32041118699999999,8.5144264619999994,6.898633394,2.2816606469999998,19.282255169999999,12.78353145,0.12428270399999999,0.0058957640000000004,248.86938180000001,45.096940160000003,68.67018539,35.014181530000002,36.227246749999999,162.9322018,38.765467460000004,2046.17659,534.36519480000004,8237.9135170000009,8.7731089999999998,0.69738633400000005,49.853153159999998,1585.513809,186.2070506,75.170943159999993,0.102945934,0.070749167000000002],\"type\":\"choropleth\",\"marker\":{\"line\":{\"color\":\"rgba(31,119,180,1)\"}},\"frame\":null}],\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.20000000000000001,\"selected\":{\"opacity\":1},\"debounce\":0},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n\n|       Seguindo a mesma lógica do mapa anterior, se você passar o *mouse* sobre os países verá o consumo identificado em cada um. Observe que há uma barrinha lateral apresentando a legenda sobre o quantitativo de produção, em  Observe também que o \"*type\"* do gráfico agora é `choroplet` (e não `scattergeo`). Na sua versão mais simples, ele só precisa dos nomes padronizados dos países. Mas também pode ser realizado com um banco de dados que possua apenas as coordenadas geográficas de latitude e longitude.\n\n|       Para auxiliar nessa direção, seguem dois *links* práticos para arquivos de coordenadas geográficas, e acessíveis pelo `R`:\n\n* [Coordenadas de municípios brasileiros](https://raw.githubusercontent.com/kelvins/municipios-brasileiros/refs/heads/main/csv/municipios.csv)\n* [Coordenadas de capitais mundiais](https://raw.githubusercontent.com/bahar/WorldCityLocations/refs/heads/master/World_Cities_Location_table.csv)\n\n|       E nesse caso, qualquer banco de dados nesse quesito será bem-vindo. O que significa na prática poder exemplificar qualquer informação de conteúdo didático de forma interativa em um mapa (ex: produção/exportação de insumos, observações clínicas, marcos históricos, etc).\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../../../site_libs/htmltools-fill-0.5.8.1/fill.css\" rel=\"stylesheet\" />\n<script src=\"../../../../site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<script src=\"../../../../site_libs/plotly-binding-4.10.4/plotly.js\"></script>\n<script src=\"../../../../site_libs/typedarray-0.1/typedarray.min.js\"></script>\n<script src=\"../../../../site_libs/jquery-3.5.1/jquery.min.js\"></script>\n<link href=\"../../../../site_libs/crosstalk-1.2.1/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"../../../../site_libs/crosstalk-1.2.1/js/crosstalk.min.js\"></script>\n<link href=\"../../../../site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css\" rel=\"stylesheet\" />\n<script src=\"../../../../site_libs/plotly-main-2.11.1/plotly-latest.min.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}