{
  "hash": "4166fb4cc70fc0bb11ccdcb4003cd605",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Mais interatividade !\"\nformat: html\ntoc: true\nnumber-sections: true\nlang: pt\n---\n\n<div class = \"reminder-objetivos\">\nObjetivos:\\\n  1. Observar a capacidade extensiva de interação com o pacote \"plotly\"\\\n  2. Elaborar um gráfico com controle deslizante\\\n  3. Elaborar um gráfico com menu suspenso \n</div>\n\n\n|       Até o momento só *\"arranhamos\"* o potencial de interatividade gráfica do pacote `plotly`. Como já mencionado, essa biblioteca permite um grande conjunto de ações de usuário, como deslizadores (*sliders*), menu de escolha, e botões, entre muitos.\n\\\n\n# Adicionando um controle deslizante por intervalo\n\n|       Um *slider* dessa natureza permite que se escolha uma janela de dados para um estudo mais detalhista naquela região. Nesse caso é possível agregar a um gráfico simples um *controle deslizante de intervalo* (*rangeslider*).\n\n\n|       Podemos ilustrar seu emprego pela observação de gases de efeito estufa, e em especial, da *emissão de dióxido de carbono no Brasil* a partir de uma base de dados da internet. Para isso, você aprenderá a *obter um arquivo a partir  de base de dados da internet, filtrar para um subconjunto desejado, e elaborar o gráfico resultante, com um controle deslizante adicional*.\n\n\n## Emissão de CO$_{2}$ e o efeito estufa\n\n\n|       As emissões de CO$_{2}$ e outros gases pela queima de combustíveis fósseis tem grande responsabilidade sobre o efeito de estufa, incidindo diretamente sobre as alterações climáticas. Para reduzir essas emissões é necessário transformar a matriz energética atual, indústria e sistemas alimentares.  \n\\\n\n|       Para compreender a emissão de CO$_{2}$ observada no Brasil no período de 1890 a 2022, execute o trecho de código que segue em um *script* do `R (ou seja, copie, cole, e execute), a partir da fonte [Our World in Data](https://github.com/owid). \n\\\n\n![Referência do MAPA para gases de efeito estufa. Fonte: MAPA: ensino médio - Ciências humanas e suas tecnologias. 1º Bim. 2º Ano, p.19.](co2_mapa.png)\n\\\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(readr) # biblioteca de importação de dados\nlibrary(dplyr) # biblioteca para uso do operador pipe \"%>%\"\nlibrary(plotly)\n\n# Carregamento dos dados da internet\nurl <- \"https://raw.githubusercontent.com/owid/co2-data/master/owid-co2-data.csv\"\nco2_data <- read.csv(url)\n\n# Filtragem dos dados para o Brasil usando subset()\nco2_brasil <- subset(co2_data, country == \"Brazil\")\n\n# Criação do gráfico interativo com plot_ly\nco2_plot <- plot_ly(data = co2_brasil, x = ~year, y = ~co2, type = 'scatter', mode = 'lines+markers') %>%\n  layout(title = \"Emissões de CO2 no Brasil ao longo dos anos\",\n         xaxis = list(title = \"Ano\"),\n         yaxis = list(title = \"Emissão de CO2 (milhões de toneladas)\"))\n```\n:::\n\n\n\n|       Agora, a cereja do bolo. A inserção de um controle deslizante, para a seleção de faixas para um estudo mais focado. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nco2_plot %>%\n  rangeslider()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"plotly html-widget html-fill-item\" id=\"htmlwidget-30f282fc2ca0e8382321\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-30f282fc2ca0e8382321\">{\"x\":{\"visdat\":{\"10983f11e0a7\":[\"function () \",\"plotlyVisDat\"]},\"cur_data\":\"10983f11e0a7\",\"attrs\":{\"10983f11e0a7\":{\"x\":{},\"y\":{},\"mode\":\"lines+markers\",\"alpha_stroke\":1,\"sizes\":[10,100],\"spans\":[1,20],\"type\":\"scatter\"}},\"layout\":{\"margin\":{\"b\":40,\"l\":60,\"t\":25,\"r\":10},\"xaxis\":{\"domain\":[0,1],\"automargin\":true,\"rangeslider\":{\"visible\":true},\"title\":\"Ano\"},\"title\":\"Emissões de CO2 no Brasil ao longo dos anos\",\"yaxis\":{\"domain\":[0,1],\"automargin\":true,\"title\":\"Emissão de CO2 (milhões de toneladas)\"},\"hovermode\":\"closest\",\"showlegend\":false},\"source\":\"A\",\"config\":{\"modeBarButtonsToAdd\":[\"hoverclosest\",\"hovercompare\"],\"showSendToCloud\":false},\"data\":[{\"x\":[1856,1857,1858,1859,1860,1861,1862,1863,1864,1865,1866,1867,1868,1869,1870,1871,1872,1873,1874,1875,1876,1877,1878,1879,1880,1881,1882,1883,1884,1885,1886,1887,1888,1889,1890,1891,1892,1893,1894,1895,1896,1897,1898,1899,1900,1901,1902,1903,1904,1905,1906,1907,1908,1909,1910,1911,1912,1913,1914,1915,1916,1917,1918,1919,1920,1921,1922,1923,1924,1925,1926,1927,1928,1929,1930,1931,1932,1933,1934,1935,1936,1937,1938,1939,1940,1941,1942,1943,1944,1945,1946,1947,1948,1949,1950,1951,1952,1953,1954,1955,1956,1957,1958,1959,1960,1961,1962,1963,1964,1965,1966,1967,1968,1969,1970,1971,1972,1973,1974,1975,1976,1977,1978,1979,1980,1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023],\"y\":[0.22700000000000001,0.26900000000000002,0.28499999999999998,0.373,0.435,0.40999999999999998,0.35499999999999998,0.42599999999999999,0.47999999999999998,0.57199999999999995,0.64600000000000002,0.55500000000000005,0.752,0.60499999999999998,0.69799999999999995,0.84499999999999997,0.85799999999999998,1.0289999999999999,0.996,0.93999999999999995,0.84299999999999997,0.878,0.94899999999999995,0.80800000000000005,0.92300000000000004,1.0309999999999999,0.94799999999999995,1.1699999999999999,1.2829999999999999,1.2150000000000001,1.236,1.3160000000000001,1.2829999999999999,1.8600000000000001,1.714,2.0720000000000001,2.1459999999999999,1.97,2.3079999999999998,2.1880000000000002,2.6160000000000001,2.734,2.681,2.613,2.2719999999999998,2.3149999999999999,2.5550000000000002,2.4420000000000002,2.6389999999999998,2.8719999999999999,3.2480000000000002,3.722,3.73,3.8260000000000001,4.585,5.3840000000000003,5.4779999999999998,6.1070000000000002,4.6580000000000004,3.2120000000000002,2.7349999999999999,2.8399999999999999,2.657,2.968,3.964,2.887,4.0270000000000001,4.7930000000000001,5.319,5.3419999999999996,5.4699999999999998,6.0389999999999997,6.0830000000000002,6.3369999999999997,5.7880000000000003,4.7729999999999997,4.7800000000000002,5.1769999999999996,5.1580000000000004,5.3780000000000001,5.617,6.7309999999999999,7.1790000000000003,5.6150000000000002,5.6539999999999999,6.2809999999999997,5.867,6.4749999999999996,5.8959999999999999,6.8230000000000004,7.46,8.9469999999999992,7.8470000000000004,7.367,19.658999999999999,21.658999999999999,24.934000000000001,25.218,29.675999999999998,34.024000000000001,36.607999999999997,35.973999999999997,39.054000000000002,39.017000000000003,46.851999999999997,49.136000000000003,53.613,55.523000000000003,56.625999999999998,56.279000000000003,64.162000000000006,66.033000000000001,77.224000000000004,84.087999999999994,93.488,102.337,114.01900000000001,132.06100000000001,143.01599999999999,150.327,154.607,162.363,177.11699999999999,187.78700000000001,186.191,171.32400000000001,171.5,165.90000000000001,167.56700000000001,180.11099999999999,197.238,205.96799999999999,207.69499999999999,212.071,218.65799999999999,229.39400000000001,233.601,244.30600000000001,254.00200000000001,268.678,289.31099999999998,306.94900000000001,317.35899999999998,327.25599999999997,340.18299999999999,346.166,347.76499999999999,344.64499999999998,361.43400000000003,364.37099999999998,368.87099999999998,390.57299999999998,412.63799999999998,389.77499999999998,440.26900000000001,462.57999999999998,498.30900000000003,532.41800000000001,557.90099999999995,529.35299999999995,492.74799999999999,498.26600000000002,478.37900000000002,473.38999999999999,445.20800000000003,498.017,483.84100000000001,486.47000000000003],\"mode\":\"lines+markers\",\"type\":\"scatter\",\"marker\":{\"color\":\"rgba(31,119,180,1)\",\"line\":{\"color\":\"rgba(31,119,180,1)\"}},\"error_y\":{\"color\":\"rgba(31,119,180,1)\"},\"error_x\":{\"color\":\"rgba(31,119,180,1)\"},\"line\":{\"color\":\"rgba(31,119,180,1)\"},\"xaxis\":\"x\",\"yaxis\":\"y\",\"frame\":null}],\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.20000000000000001,\"selected\":{\"opacity\":1},\"debounce\":0},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\\\n\n|       Você pode copiar e colar os *scripts* na sequência para sua execução, ou apenas adicionar o comando `rangeslider()` com o operador *pipe* %>% ao final.\n\n|       Experimente agora posicionar o *mouse* num dos dois marcadores laterais do gráfico inferior, arrastando-o em seguida, e observe o resultado. O controle deslizante pode ser útil quando se deseja focar em determinada região do gráfico. Por exemplo, ajustar a emissão de CO$_{2}$ para os últimos anos.\n\n\n\n\n### Adicionando um menu suspenso\n\n|       Menus suspensos (*dropdown menu*) permitem observar um gráfico diferente a cada opção selecionada. Para exemplificar esse recurso interativos, vamos primeiramente elaborar um conjunto de dados (*dataframe*) que possua a resposta linear, quadrática, e cúbica a uma variável independente, tal como segue:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nx = 1:10 # vetor da variável independente \"x\"\nyLin = x\nyQuad = x^2 # criação da variável dependente quadrática \nyCub = x^3 # criação da variável dependente cúbica \n\ndatLQC <-data.frame(x,yLin,yQuad,yCub) # criação da planilha de dados\n```\n:::\n\n\n\n|       Agora podemos inserir o *menu suspenso* para opção das tendências matemáticas:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_ly(datLQC, x = ~x, y = ~yLin, type = \"scatter\", mode = \"line\", name = \"Linear\") %>%\n  add_trace(x = ~x, y = ~yQuad, mode = \"line\", name = \"Quadratic\") %>%\n  add_trace(x = ~x, y = ~yCub, mode = \"line\", name = \"Cubic\") %>%\n  layout(\n    title = \"Power Graphs\",\n    xaxis = list(title = \"x\"),\n    yaxis = list(title = \"x^n\"),\n    updatemenus = list(\n      list(\n        buttons = list(\n          list(label = \"yLin\", method = \"update\", args = list(list(visible = c(TRUE, FALSE, FALSE)))),\n          list(label = \"yQuad\", method = \"update\", args = list(list(visible = c(FALSE, TRUE, FALSE)))),\n          list(label = \"yCub\", method = \"update\", args = list(list(visible = c(FALSE, FALSE, TRUE))))\n        )\n      )\n    )\n  )\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"plotly html-widget html-fill-item\" id=\"htmlwidget-75df1310b03861a0a8f5\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-75df1310b03861a0a8f5\">{\"x\":{\"visdat\":{\"165df4f8fa593\":[\"function () \",\"plotlyVisDat\"]},\"cur_data\":\"165df4f8fa593\",\"attrs\":{\"165df4f8fa593\":{\"x\":{},\"y\":{},\"mode\":\"line\",\"name\":\"Linear\",\"alpha_stroke\":1,\"sizes\":[10,100],\"spans\":[1,20],\"type\":\"scatter\"},\"165df4f8fa593.1\":{\"x\":{},\"y\":{},\"mode\":\"line\",\"name\":\"Quadratic\",\"alpha_stroke\":1,\"sizes\":[10,100],\"spans\":[1,20],\"type\":\"scatter\",\"inherit\":true},\"165df4f8fa593.2\":{\"x\":{},\"y\":{},\"mode\":\"line\",\"name\":\"Cubic\",\"alpha_stroke\":1,\"sizes\":[10,100],\"spans\":[1,20],\"type\":\"scatter\",\"inherit\":true}},\"layout\":{\"margin\":{\"b\":40,\"l\":60,\"t\":25,\"r\":10},\"title\":\"Power Graphs\",\"xaxis\":{\"domain\":[0,1],\"automargin\":true,\"title\":\"x\"},\"yaxis\":{\"domain\":[0,1],\"automargin\":true,\"title\":\"x^n\"},\"updatemenus\":[{\"buttons\":[{\"label\":\"yLin\",\"method\":\"update\",\"args\":[{\"visible\":[true,false,false]}]},{\"label\":\"yQuad\",\"method\":\"update\",\"args\":[{\"visible\":[false,true,false]}]},{\"label\":\"yCub\",\"method\":\"update\",\"args\":[{\"visible\":[false,false,true]}]}]}],\"hovermode\":\"closest\",\"showlegend\":true},\"source\":\"A\",\"config\":{\"modeBarButtonsToAdd\":[\"hoverclosest\",\"hovercompare\"],\"showSendToCloud\":false},\"data\":[{\"x\":[1,2,3,4,5,6,7,8,9,10],\"y\":[1,2,3,4,5,6,7,8,9,10],\"mode\":\"line\",\"name\":\"Linear\",\"type\":\"scatter\",\"marker\":{\"color\":\"rgba(31,119,180,1)\",\"line\":{\"color\":\"rgba(31,119,180,1)\"}},\"error_y\":{\"color\":\"rgba(31,119,180,1)\"},\"error_x\":{\"color\":\"rgba(31,119,180,1)\"},\"line\":{\"color\":\"rgba(31,119,180,1)\"},\"xaxis\":\"x\",\"yaxis\":\"y\",\"frame\":null},{\"x\":[1,2,3,4,5,6,7,8,9,10],\"y\":[1,4,9,16,25,36,49,64,81,100],\"mode\":\"line\",\"name\":\"Quadratic\",\"type\":\"scatter\",\"marker\":{\"color\":\"rgba(255,127,14,1)\",\"line\":{\"color\":\"rgba(255,127,14,1)\"}},\"error_y\":{\"color\":\"rgba(255,127,14,1)\"},\"error_x\":{\"color\":\"rgba(255,127,14,1)\"},\"line\":{\"color\":\"rgba(255,127,14,1)\"},\"xaxis\":\"x\",\"yaxis\":\"y\",\"frame\":null},{\"x\":[1,2,3,4,5,6,7,8,9,10],\"y\":[1,8,27,64,125,216,343,512,729,1000],\"mode\":\"line\",\"name\":\"Cubic\",\"type\":\"scatter\",\"marker\":{\"color\":\"rgba(44,160,44,1)\",\"line\":{\"color\":\"rgba(44,160,44,1)\"}},\"error_y\":{\"color\":\"rgba(44,160,44,1)\"},\"error_x\":{\"color\":\"rgba(44,160,44,1)\"},\"line\":{\"color\":\"rgba(44,160,44,1)\"},\"xaxis\":\"x\",\"yaxis\":\"y\",\"frame\":null}],\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.20000000000000001,\"selected\":{\"opacity\":1},\"debounce\":0},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n\n|       Ainda que você possa achar meio complicado o trecho de código acima, apenas copie-o, cole-o num *script*, e execute-o. Isso exemplifica a *essência inerente ao Ensino Reprodutível, desde a simples reprodução do código, até sua alteração e mesmo a criação de novos*. Sentindo curiosidade, você pode alterar alguns termos do código acima, como as etiquetas (*label*, substitua um nome, por ex) que surgem no menu suspenso, o tipo de gráfico pretendido (substitua *scatter* por *bar*, por exemplo), ou o título do gráfico (*title*).\n\\\n\n|       Em relação à interatividade produzida, adiciona-se às que já estavam presentes pelo comando `plot_ly`, a seleção do tipo de potência a representar pelo menu suspenso.\n\\\n\n\n|       Assim como para vários pacotes do `R`, existe um número significativo de comandos e *widgets interativos* com o `plotly`, e que, nesse caso específico, daria \"pano pra manga\" pra uma obra literária isolada. Mas você pode consultar inúmeros *sites* sobre o `plotly` para um aprendizado mais abrangente, os *links* abaixo, e mesmo um [livro online](https://plotly-r.com/) gratuito, com códigos e gráficos correlatos. Para observar a imensa riqueza de gráficos interativos, dê uma olhada no [website do `plotly`](https://plotly.com/r/) para o `R`.\n\\\n\n*   [Geral](https://cran.r-project.org/web/packages/plotly/index.html)\n*   [Manual](https://cran.r-project.org/web/packages/plotly/plotly.pdf)\n*   [Tutorial](https://plotly.com/r/)\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../../../site_libs/htmltools-fill-0.5.8.1/fill.css\" rel=\"stylesheet\" />\n<script src=\"../../../../site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<script src=\"../../../../site_libs/plotly-binding-4.10.4/plotly.js\"></script>\n<script src=\"../../../../site_libs/typedarray-0.1/typedarray.min.js\"></script>\n<script src=\"../../../../site_libs/jquery-3.5.1/jquery.min.js\"></script>\n<link href=\"../../../../site_libs/crosstalk-1.2.1/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"../../../../site_libs/crosstalk-1.2.1/js/crosstalk.min.js\"></script>\n<link href=\"../../../../site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css\" rel=\"stylesheet\" />\n<script src=\"../../../../site_libs/plotly-main-2.11.1/plotly-latest.min.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}